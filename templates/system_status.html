{% extends "base.html" %}

{% block title %}系统环境信息 - API服务中心{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- 顶部导航 -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="/" class="text-gray-600 hover:text-gray-900 mr-4">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">系统环境信息</h1>
                        <p class="text-sm text-gray-500">查看系统运行环境的详细配置信息</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        <i class="fas fa-circle text-green-500 mr-1"></i>在线
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- 主容器 -->
    <div class="max-w-6xl mx-auto px-4 py-8">
        {% if system_info.error %}
            <!-- 错误提示 -->
            <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                <div class="flex items-center">
                    <i class="fas fa-exclamation-circle text-red-600 text-2xl mr-4"></i>
                    <div>
                        <h3 class="font-semibold text-red-900">获取系统信息失败</h3>
                        <p class="text-red-700 text-sm">{{ system_info.error }}</p>
                    </div>
                </div>
            </div>
        {% else %}
            <!-- 应用信息卡片 -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-info-circle text-blue-600 mr-3"></i>应用信息
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <p class="text-sm text-gray-600 mb-2">应用名称</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.app_name }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">应用版本</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.version }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">开发团队</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.author }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">时区</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.timezone }}</p>
                    </div>
                    <div class="md:col-span-2">
                        <p class="text-sm text-gray-600 mb-2">存储模式</p>
                        <div class="flex items-center">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium {% if 'SQLAlchemy' in system_info.storage_mode %}bg-blue-100 text-blue-800{% else %}bg-purple-100 text-purple-800{% endif %}">
                                <i class="fas fa-{% if 'SQLAlchemy' in system_info.storage_mode %}database{% else %}file{% endif %} mr-2"></i>{{ system_info.storage_mode }}
                            </span>
                        </div>
                    </div>
                    {% if 'SQLAlchemy' in system_info.storage_mode and system_info.database_url %}
                    <div class="md:col-span-2">
                        <p class="text-sm text-gray-600 mb-2">数据库地址</p>
                        <p class="text-sm font-mono bg-gray-100 p-3 rounded text-gray-800 break-all">{{ system_info.database_url }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Python & Flask 信息卡片 -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-code text-yellow-600 mr-3"></i>运行环境
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <p class="text-sm text-gray-600 mb-2">Python 版本</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.python_version }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">Flask 版本</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.flask_version }}</p>
                    </div>
                </div>
            </div>

            <!-- 操作系统信息卡片 -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-server text-green-600 mr-3"></i>操作系统
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <p class="text-sm text-gray-600 mb-2">系统</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.platform }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">系统版本</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.platform_release }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">架构</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.architecture }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">主机名</p>
                        <p class="text-lg font-semibold text-gray-900">{{ system_info.hostname }}</p>
                    </div>
                    {% if system_info.processor %}
                    <div class="md:col-span-2">
                        <p class="text-sm text-gray-600 mb-2">处理器</p>
                        <p class="text-sm text-gray-900">{{ system_info.processor }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- 硬件信息卡片 -->
            {% if system_info.cpu_count %}
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-microchip text-purple-600 mr-3"></i>硬件资源
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-blue-600 mb-1">CPU 核心数</p>
                                <p class="text-3xl font-bold text-blue-900">{{ system_info.cpu_count }}</p>
                            </div>
                            <i class="fas fa-microchip text-4xl text-blue-200"></i>
                        </div>
                        <p class="text-xs text-blue-600">逻辑处理器</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-red-600 mb-1">CPU 使用率</p>
                                <p class="text-3xl font-bold text-red-900">{{ "%.1f"|format(system_info.cpu_percent) }}%</p>
                            </div>
                            <i class="fas fa-tachometer-alt text-4xl text-red-200"></i>
                        </div>
                        <p class="text-xs text-red-600">当前占用</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-green-600 mb-1">总内存</p>
                                <p class="text-3xl font-bold text-green-900">{{ system_info.memory_total }}</p>
                            </div>
                            <i class="fas fa-memory text-4xl text-green-200"></i>
                        </div>
                        <p class="text-xs text-green-600">物理内存</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-amber-50 to-amber-100 p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-amber-600 mb-1">可用内存</p>
                                <p class="text-3xl font-bold text-amber-900">{{ system_info.memory_available }}</p>
                            </div>
                            <i class="fas fa-chart-pie text-4xl text-amber-200"></i>
                        </div>
                        <p class="text-xs text-amber-600">未占用内存</p>
                    </div>

                    <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 p-6 rounded-lg md:col-span-2">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="text-sm text-indigo-600 mb-1">内存使用率</p>
                                <p class="text-3xl font-bold text-indigo-900">{{ system_info.memory_percent }}</p>
                            </div>
                            <i class="fas fa-layer-group text-4xl text-indigo-200"></i>
                        </div>
                        <div class="w-full bg-indigo-200 rounded-full h-2 overflow-hidden">
                            {% set mem_val = system_info.memory_percent.rstrip('%')|float %}
                            <div class="bg-indigo-600 h-2 rounded-full transition-all duration-500" data-width="{{ mem_val }}"></div>
                        </div>
                        <p class="text-xs text-indigo-600 mt-2">内存占用比例</p>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- 网络环境信息卡片 -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-network-wired text-cyan-600 mr-3"></i>网络环境
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% if system_info.network_info.status == '正常' %}
                    <div class="md:col-span-2 bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                            <div>
                                <p class="font-semibold text-green-900">网络状态: 正常</p>
                            </div>
                        </div>
                    </div>
                    {% elif system_info.network_info.status == '警告' %}
                    <div class="md:col-span-2 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-circle text-yellow-600 text-2xl mr-3"></i>
                            <div>
                                <p class="font-semibold text-yellow-900">网络状态: 警告</p>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="md:col-span-2 bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-times-circle text-red-600 text-2xl mr-3"></i>
                            <div>
                                <p class="font-semibold text-red-900">网络状态: 异常</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% for detail in system_info.network_info.details %}
                    <div>
                        <p class="text-sm text-gray-600 mb-2">{{ detail.split(': ')[0] }}</p>
                        <p class="text-sm font-mono bg-gray-100 p-2 rounded text-gray-800">{{ detail.split(': ', 1)[1] }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- 数据库信息卡片 -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-database text-indigo-600 mr-3"></i>数据库信息
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% if system_info.database_info.status == '正常' %}
                    <div class="md:col-span-2 bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                            <div>
                                <p class="font-semibold text-green-900">数据库状态: 正常 ({{ system_info.database_info.type }})</p>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="md:col-span-2 bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center">
                            <i class="fas fa-times-circle text-red-600 text-2xl mr-3"></i>
                            <div>
                                <p class="font-semibold text-red-900">数据库状态: 异常</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% for detail in system_info.database_info.details %}
                    <div>
                        <p class="text-sm text-gray-600 mb-2">{{ detail.split(': ')[0] }}</p>
                        <p class="text-sm font-mono bg-gray-100 p-2 rounded text-gray-800 break-all">{{ detail.split(': ', 1)[1] }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- 配置信息卡片 -->
            <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-cogs text-orange-600 mr-3"></i>配置信息
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    {% for detail in system_info.config_info.details %}
                    <div>
                        <p class="text-sm text-gray-600 mb-2">{{ detail.split(': ')[0] }}</p>
                        <p class="text-sm font-mono bg-gray-100 p-2 rounded text-gray-800 break-all">{{ detail.split(': ', 1)[1] }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- 系统时间 -->
            <div class="bg-white rounded-xl shadow-sm p-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center">
                    <i class="fas fa-clock text-orange-600 mr-3"></i>系统时间
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div>
                        <p class="text-sm text-gray-600 mb-2">当前时间</p>
                        <p class="text-lg font-semibold text-gray-900 font-mono">
                            {% set parts = system_info.timestamp.split('T') %}
                            {{ parts[0] }} {{ parts[1][:8] if parts|length > 1 else '' }}
                        </p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 mb-2">ISO 8601 格式</p>
                        <p class="text-sm text-gray-900 font-mono bg-gray-100 p-2 rounded break-all">{{ system_info.timestamp }}</p>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>

    <!-- 页脚 -->
    <footer class="bg-white py-4 border-t border-gray-200 mt-12">
        <div class="container mx-auto text-center text-gray-500 text-sm">
            <p>© 2025 API服务中心 - 版权所有</p>
        </div>
    </footer>
</div>

<script>
    // 设置内存使用率进度条的宽度
    document.addEventListener('DOMContentLoaded', function() {
        const progressBar = document.querySelector('[data-width]');
        if (progressBar) {
            const width = progressBar.getAttribute('data-width');
            progressBar.style.width = width + '%';
        }
    });
</script>

<style>
    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}
